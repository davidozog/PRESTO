#!/usr/bin/env python

import sys
import subprocess
import os

if (len(sys.argv) < 3):
  #exit('Please tell me the number of processes you want: "launch_interative_Rinth <num_workers+1>"')
  exit('Usage:  "launch_interative_Rinth   < num_workers+1 >   < java | matlab >   < Java_App_Name > "')

print sys.argv[1]
if sys.argv[2] == 'matlab':
  pyargs = sys.argv[2]
elif sys.argv[2] == 'java':
  pyargs = sys.argv[2] + ' ' + sys.argv[3]


subprocess.call('module purge', shell=True)
subprocess.call('module load python matlab', shell=True)
subprocess.call('module load mpi-tor/openmpi-1.4.5_gcc-4.4.6', shell=True)

subprocess.call('mpiexec --mca btl_tcp_if_include eth0 -np ' + sys.argv[1] + ' python '+ os.environ['MATLABYRINTH'] + '/src/MATLAByrinth/MATLAByrinth.py ' + pyargs , shell=True)
